# AutoGen BI Agent 使用指南

## 简介
AutoGen BI Agent 是一个基于 AutoGen 框架的 BI 查询智能体，专注于多轮对话、意图识别和信息收集功能。它可以识别用户意图，收集必要信息，并提取标准指标名称。

## 功能特点
- **多轮对话**：支持上下文记忆和连续对话
- **意图识别**：快速判断用户查询是否为 BI 相关
- **信息收集**：智能收集缺失的项目、时间和指标信息
- **参数提取**：从对话中精准提取关键参数
- **流式模式**：支持流式输出，兼容百炼 API 等只支持流式模式的服务

## 配置参数
- **model**：用于 BI 智能体的模型，如 GPT-4、百炼等
- **query**：用户输入的查询文本
- **conversation_id**：对话 ID，用于多轮对话记忆
- **maximum_iterations**：最大迭代次数，默认为 5

## 使用示例
在 Dify 工作流中添加 AutoGen BI Agent 策略，配置以下参数：
- Agent 策略：BI参数提取
- 模型：选择合适的模型
- 用户输入：必填
- 对话 ID：用于多轮对话记忆

## 输出说明
插件会返回以下信息：
- **响应内容**：智能体的回复
- **变量**：
  - `is_bi_query`：是否为 BI 查询
  - `is_complete`：信息是否完整
  - `extracted_params`：提取的参数，包括项目、时间和指标
  - `project_name`：提取的项目名称
  - `date`：提取的日期
  - `target_name`：提取的指标名称
  - `conversation_id`：对话 ID

## 工作流集成示例

### 1. 创建节点
在 Dify 工作流中创建一个 Agent 策略节点，选择 "AutoGen BI Agent" 策略。

### 2. 配置参数
- **模型**：选择支持的模型，如 GPT-4、百炼等
- **用户输入**：设置为用户消息或前一节点的输出
- **对话 ID**：设置为唯一标识符，用于记忆对话上下文

### 3. 处理输出
在后续节点中，可以根据以下条件处理输出：
- 如果 `is_bi_query` 为 false，可以转向通用回答流程
- 如果 `is_complete` 为 false，可以继续对话收集信息
- 如果 `is_complete` 为 true，可以使用提取的参数调用数据 API

## 注意事项
- 确保环境变量中设置了 `OPENAI_API_KEY` 和 `OPENAI_API_BASE_URL`（如果使用自定义 API）
- 对于首次使用，建议启用记忆功能以获得更好的对话体验
- 如需使用本地向量数据库功能，请确保配置了正确的文档路径
